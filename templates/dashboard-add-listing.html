<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Basic Page Needs ================================================== -->
    <title>Agregar usuario - Centro medico</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- CSS ================================================== -->
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/css/main-color.css" id="colors">
</head>

<body>

<!-- Wrapper -->
<div id="wrapper">

    <!-- Header Container ================================================== -->
    <header id="header-container" class="fixed fullwidth dashboard">
        <!-- Header -->
        <div id="header" class="not-sticky">
            <div class="container">
                <!-- Left Side Content -->
                <div class="left-side">
                    <!-- Logo -->
                    <div id="logo">
                        <a href="index.html"><img src="images/logo.png" alt=""></a>
                        <a href="index.html" class="dashboard-logo"><img src="images/logo2.png" alt=""></a>
                    </div>
                    <!-- Mobile Navigation -->
                    <div class="mmenu-trigger">
                        <button class="hamburger hamburger--collapse" type="button">
                            <span class="hamburger-box">
                                <span class="hamburger-inner"></span>
                            </span>
                        </button>
                    </div>
                </div>
                <!-- Left Side Content / End -->

                <!-- Right Side Content / End -->
                <div class="right-side">
                    <!-- Header Widget -->
                    <div class="header-widget">
                        <!-- User Menu -->
                        <div class="user-menu">
                            <div class="user-name"><span><img src="../static/images/user_profile2.svg" alt=""></span>Mi cuenta</div>
                        </div>

                        <a href="/dashboard-cargar-usuario" class="button border with-icon">Agregar <i class="sl sl-icon-plus"></i></a>
                    </div>
                    <!-- Header Widget / End -->
                </div>
                <!-- Right Side Content / End -->
            </div>
        </div>
        <!-- Header / End -->
    </header>
    <div class="clearfix"></div>
    <!-- Header Container / End -->

    <!-- Dashboard -->
    <div id="dashboard">
        <!-- Navigation ================================================== -->
        <!-- Responsive Navigation Trigger -->
        <a href="#" class="dashboard-responsive-nav-trigger"><i class="fa fa-reorder"></i> Dashboard Navigation</a>

        <div class="dashboard-nav">
            <div class="dashboard-nav-inner">
                <ul data-submenu-title="tablero">
                    <li class="active"><a href="/dashboard"><i class="sl sl-icon-settings"></i> Dashboard</a></li>
                </ul>
                <ul data-submenu-title="Listados">
                    <li><a><i class="sl sl-icon-layers"></i> Listados</a>
                        <ul>
                            <li><a href="/dashboard-my-listings">Medicos <span class="nav-tag green">6</span></a></li>
                            <li><a href="/dashboard-my-listings">Adminsitrativos <span class="nav-tag yellow">1</span></a></li>
                            <li><a href="/dashboard-my-listings">Pacientes <span class="nav-tag red">2</span></a></li>
                        </ul>
                    </li>
                    <li><a href="/dashboard-cargar-usuario"><i class="sl sl-icon-plus"></i> Crear nuevo usuario</a></li>
                </ul>
                <ul data-submenu-title="Cuenta">
                    <li><a href="/dashboard-my-profile"><i class="sl sl-icon-user"></i> Mi perfil</a></li>
                    <li><a href="/index"><i class="sl sl-icon-power"></i> Salir</a></li>
                </ul>
            </div>
        </div>
        <!-- Navigation / End -->

        <!-- Content ================================================== -->
        <div class="dashboard-content">
            <!-- Titlebar -->
            <div id="titlebar">
                <div class="row">
                    <div class="col-md-12">
                        <h2>Agregar usuario</h2>
                        <!-- Breadcrumbs -->
                        <nav id="breadcrumbs">
                            <ul>
                                <li><a href="#">Inicio</a></li>
                                <li><a href="#">Dashboard</a></li>
                                <li>Agregar usuario</li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <div id="add-listing">
                        <!-- Section -->
                        <div class="add-listing-section">
                            <!-- Headline -->
                            <div class="add-listing-headline">
                                <h3><i class="sl sl-icon-doc"></i> Informacion basica</h3>
                            </div>

                            <!-- Formulario de registro -->
                            <form id="registerForm" enctype="multipart/form-data" method="POST">
                                <!-- Mensajes flash -->
                                {% with messages = get_flashed_messages(with_categories=true) %}
                                    {% if messages %}
                                        <div class="alert">
                                            {% for category, message in messages %}
                                                <div class="alert alert-{{ category }}">{{ message }}</div>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                {% endwith %}
                                <div class="row with-forms">
                                    <div class="col-md-6">
                                        <h5>Nombre</h5>
                                        <input class="search-field" type="text" name="nombre" required/>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Apellido</h5>
                                        <input class="search-field" type="text" name="apellido" required/>
                                    </div>
                                    <div class="col-md_6">
                                        <h5>RUT</h5>
                                        <input class="search-field" type="text" name="rut" required/>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Fecha de nacimiento</h5>
                                        <input class="search-field" type="date" name="fecha_nacimiento" required/>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Nacionalidad</h5>
                                        <input class="search-field" type="text" name="nacionalidad" required/>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Perfil</h5>
                                        <select class="chosen-select-no-single" name="perfil" required>
                                            <option label="blank">Selecciona un perfil</option>
                                            <option value="Administrativo">Administrativo</option>
                                            <option value="Profesional">Profesional</option>
                                            <option value="Paciente">Paciente</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Especialidad para los medicos</h5>
                                        <select class="chosen-select-no-single" name="especialidad">
                                            <option label="blank">Selecciona una especialidad</option>
                                            <option value="Medicina General">Medicina General</option>
                                            <option value="Kinesiologia">Kinesiologia</option>
                                            <option value="Cardiologia">Cardiologia</option>
                                            <option value="Dental">Dental</option>
                                            <option value="Broncopulmonar">Broncopulmonar</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Sexo</h5>
                                        <select class="chosen-select-no-single" name="sexo" required>
                                            <option label="blank">Selecciona un perfil</option>
                                            <option value="Masculino">Masculino</option>
                                            <option value="Femenino">Femenino</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Comuna</h5>
                                        <select class="chosen-select-no-single" name="comuna" required>
                                            <option label="blank">Selecciona</option>
                                            <option value="1">Puente Alto</option>
                                            <option value="2">La Florida</option>
                                            <option value="3">Macul</option>
                                            <option value="4">Pirque</option>
                                            <option value="5">La Pintana</option>
                                            <option value="6">Santiago</option>
                                            <option value="7">Estacion Central</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Direccion</h5>
                                        <input class="search-field" type="text" name="direccion" placeholder="Ejemplo: Concha y Toro 2730" required>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Telefono</h5>
                                        <input class="search-field" type="text" name="telefono">
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Email</h5>
                                        <input class="search-field" type="email" name="email" required>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Website</h5>
                                        <input class="search-field" type="text" name="website">
                                    </div>
                                </div>

                                <!-- Section -->
                                <div class="add-listing-section margin-top-45">
                                    <div class="add-listing-headline">
                                        <h3><i class="sl sl-icon-location"></i> Imagen perfil</h3>
                                    </div>
                                    <div class="submit-section">
                                        <input type="file" name="imagen_perfil" accept="image/*">
                                    </div>
                                </div>

                                <!-- Section -->
                                <div class="add-listing-section margin-top-45">
                                    <div class="add-listing-headline">
                                        <h3><i class="fa fa-calendar-check-o"></i> Horarios</h3>
                                        <label class="switch"><input type="checkbox" checked><span class="slider round"></span></label>
                                    </div>
                                    <div class="switcher-content">
                                        <div class="availability-slots" data-clock-type="24hr">
                                            <!-- Lunes -->
                                            <div class="day-slots">
                                                <div class="day-slot-headline">Lunes</div>
                                                <div class="slots-container">
                                                    <div class="single-slot">
                                                        <div class="single-slot-left">
                                                            <input type="time" class="time-slot-start" name="horario_lunes_inicio">
                                                            <span>-</span>
                                                            <input type="time" class="time-slot-end" name="horario_lunes_fin">
                                                            <button class="remove-slot"><i class="fa fa-close"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="add-slot">
                                                    <div class="add-slot-inputs">
                                                        <input type="time" class="time-slot-start">
                                                        <span>-</span>
                                                        <input type="time" class="time-slot-end">
                                                    </div>
                                                    <div class="add-slot-btn">
                                                        <button>Agregar</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Martes -->
                                            <div class="day-slots">
                                                <div class="day-slot-headline">Martes</div>
                                                <div class="slots-container">
                                                    <div class="single-slot">
                                                        <div class="single-slot-left">
                                                            <input type="time" class="time-slot-start" name="horario_martes_inicio">
                                                            <span>-</span>
                                                            <input type="time" class="time-slot-end" name="horario_martes_fin">
                                                            <button class="remove-slot"><i class="fa fa-close"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="add-slot">
                                                    <div class="add-slot-inputs">
                                                        <input type="time" class="time-slot-start">
                                                        <span>-</span>
                                                        <input type="time" class="time-slot-end">
                                                    </div>
                                                    <div class="add-slot-btn">
                                                        <button>Agregar</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Miércoles -->
                                            <div class="day-slots">
                                                <div class="day-slot-headline">Miercoles</div>
                                                <div class="slots-container">
                                                    <div class="single-slot">
                                                        <div class="single-slot-left">
                                                            <input type="time" class="time-slot-start" name="horario_miercoles_inicio">
                                                            <span>-</span>
                                                            <input type="time" class="time-slot-end" name="horario_miercoles_fin">
                                                            <button class="remove-slot"><i class="fa fa-close"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="add-slot">
                                                    <div class="add-slot-inputs">
                                                        <input type="time" class="time-slot-start">
                                                        <span>-</span>
                                                        <input type="time" class="time-slot-end">
                                                    </div>
                                                    <div class="add-slot-btn">
                                                        <button>Agregar</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Jueves -->
                                            <div class="day-slots">
                                                <div class="day-slot-headline">Jueves</div>
                                                <div class="slots-container">
                                                    <div class="single-slot">
                                                        <div class="single-slot-left">
                                                            <input type="time" class="time-slot-start" name="horario_jueves_inicio">
                                                            <span>-</span>
                                                            <input type="time" class="time-slot-end" name="horario_jueves_fin">
                                                            <button class="remove-slot"><i class="fa fa-close"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="add-slot">
                                                    <div class="add-slot-inputs">
                                                        <input type="time" class="time-slot-start">
                                                        <span>-</span>
                                                        <input type="time" class="time-slot-end">
                                                    </div>
                                                    <div class="add-slot-btn">
                                                        <button>Agregar</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Viernes -->
                                            <div class="day-slots">
                                                <div class="day-slot-headline">Viernes</div>
                                                <div class="slots-container">
                                                    <div class="single-slot">
                                                        <div class="single-slot-left">
                                                            <input type="time" class="time-slot-start" name="horario_viernes_inicio">
                                                            <span>-</span>
                                                            <input type="time" class="time-slot-end" name="horario_viernes_fin">
                                                            <button class="remove-slot"><i class="fa fa-close"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="add-slot">
                                                    <div class="add-slot-inputs">
                                                        <input type="time" class="time-slot-start">
                                                        <span>-</span>
                                                        <input type="time" class="time-slot-end">
                                                    </div>
                                                    <div class="add-slot-btn">
                                                        <button>Agregar</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Sábado -->
                                            <div class="day-slots">
                                                <div class="day-slot-headline">Sabado</div>
                                                <div class="slots-container">
                                                    <div class="single-slot">
                                                        <div class="single-slot-left">
                                                            <input type="time" class="time-slot-start" name="horario_sabado_inicio">
                                                            <span>-</span>
                                                            <input type="time" class="time-slot-end" name="horario_sabado_fin">
                                                            <button class="remove-slot"><i class="fa fa-close"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="add-slot">
                                                    <div class="add-slot-inputs">
                                                        <input type="time" class="time-slot-start">
                                                        <span>-</span>
                                                        <input type="time" class="time-slot-end">
                                                    </div>
                                                    <div class="add-slot-btn">
                                                        <button>Agregar</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Domingo -->
                                            <div class="day-slots">
                                                <div class="day-slot-headline">Domingo</div>
                                                <div class="slots-container">
                                                    <div class="single-slot">
                                                        <div class="single-slot-left">
                                                            <input type="time" class="time-slot-start" name="horario_domingo_inicio">
                                                            <span>-</span>
                                                            <input type="time" class="time-slot-end" name="horario_domingo_fin">
                                                            <button class="remove-slot"><i class="fa fa-close"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="add-slot">
                                                    <div class="add-slot-inputs">
                                                        <input type="time" class="time-slot-start">
                                                        <span>-</span>
                                                        <input type="time" class="time-slot-end">
                                                    </div>
                                                    <div class="add-slot-btn">
                                                        <button>Agregar</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <button type="submit" class="button preview">Crear <i class="fa fa-arrow-circle-right"></i></button>
                            </form>
                        </div>
                        <!-- Section / End -->
                    </div>
                </div>

                <!-- Copyrights -->
                <div class="col-md-12">
                    <div class="copyrights">© 2024 Centro medico. Todos los derechos reservados.</div>
                </div>
            </div>
        </div>
        <!-- Content / End -->
    </div>
    <!-- Dashboard / End -->
</div>
<!-- Wrapper / End -->

<!-- Scripts ================================================== -->
<script type="text/javascript" src="../static/scripts/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="../static/scripts/jquery-migrate-3.3.2.min.js"></script>
<script type="text/javascript" src="../static/scripts/mmenu.min.js"></script>
<script type="text/javascript" src="../static/scripts/chosen.min.js"></script>
<script type="text/javascript" src="../static/scripts/slick.min.js"></script>
<script type="text/javascript" src="../static/scripts/rangeslider.min.js"></script>
<script type="text/javascript" src="../static/scripts/magnific-popup.min.js"></script>
<script type="text/javascript" src="../static/scripts/waypoints.min.js"></script>
<script type="text/javascript" src="../static/scripts/counterup.min.js"></script>
<script type="text/javascript" src="../static/scripts/jquery-ui.min.js"></script>
<script type="text/javascript" src="../static/scripts/tooltips.min.js"></script>
<script type="text/javascript" src="../static/scripts/custom.js"></script>
<script type="text/javascript" src="../static/scripts/dropzone.js"></script>

<script>
    document.getElementById('registerForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(this);
        const alertDiv = document.getElementById('alert');

        const horarios = [];
        document.querySelectorAll('.day-slots').forEach(daySlot => {
            const day = daySlot.querySelector('.day-slot-headline').innerText;
            daySlot.querySelectorAll('.single-slot').forEach(slot => {
                const inicio = slot.querySelector('.time-slot-start').value;
                const fin = slot.querySelector('.time-slot-end').value;
                if (inicio && fin) {
                    horarios.push({ dia: day, hora_inicio: inicio, hora_fin: fin });
                }
            });
        });

        formData.append('horarios', JSON.stringify(horarios));

        fetch('/dashboard-add-listing', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = '/dashboard';
            } else {
                alertDiv.innerText = data.message;
                alertDiv.style.display = 'block';
                alertDiv.classList.add('alert-danger');
            }
        })
        .catch(error => console.error('Error:', error));
    });
</script>

</body>
</html>
